This code handles a web API endpoint that retrieves course lists for either students or instructors. For students, it returns courses they're enrolled in, hiding sensitive data. For instructors, it filters courses by status (active, archived, or soft-deleted) and includes their permissions for each course. The endpoint requires user authentication and checks if the requester has proper access rights based on their role (student/instructor). The returned data is formatted as JSON.